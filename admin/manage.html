<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>OceanBooks ‚Äì Manage Books</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
body{
  background:radial-gradient(circle at top,#020202,#000);
  color:#fff;min-height:100vh;
  padding:100px 6% 60px;overflow-x:hidden;
}

/* Header */
header{
  position:fixed;top:0;left:0;width:100%;
  background:rgba(20,20,20,0.8);
  backdrop-filter:blur(12px);
  border-bottom:1px solid rgba(255,255,255,0.08);
  padding:1rem 6%;
  display:flex;justify-content:space-between;align-items:center;
  z-index:1000;
}
header h1{
  font-size:1.6rem;
  background:linear-gradient(90deg,#00ffaa,#00e0ff);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  text-shadow:0 0 15px rgba(0,255,255,0.25);
}
.nav-links{
  display:flex;align-items:center;gap:1.2rem;
}
.nav-links a{
  color:#bbb;text-decoration:none;font-weight:500;transition:.25s;
}
.nav-links a:hover{color:#00ffaa;text-shadow:0 0 10px #00ffaa;}
.menu-toggle{display:none;font-size:1.4rem;color:#00e0ff;cursor:pointer;}
@media(max-width:768px){
  .nav-links{
    position:absolute;top:100%;right:0;
    flex-direction:column;background:rgba(10,10,10,0.95);
    border:1px solid rgba(255,255,255,0.08);
    border-radius:10px;padding:1rem 1.5rem;
    display:none;
  }
  .nav-links.active{display:flex;}
  .menu-toggle{display:block;}
}

/* Filter buttons */
.filters{
  text-align:center;margin-top:100px;margin-bottom:20px;
}
.filters button{
  background:rgba(25,25,25,0.8);
  border:1px solid rgba(255,255,255,0.1);
  color:#00e0ff;font-weight:600;
  padding:0.6rem 1.4rem;border-radius:10px;margin:0 5px;
  cursor:pointer;transition:0.3s;
}
.filters button.active{
  background:linear-gradient(90deg,#00ffaa,#00e0ff);
  color:#000;
}
.filters button:hover{transform:translateY(-2px);}

/* Grid */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:1.5rem;
}
.card{
  background:rgba(25,25,25,0.9);
  border-radius:16px;border:1px solid rgba(255,255,255,0.05);
  box-shadow:0 0 20px rgba(0,255,255,0.1);
  padding:1rem;display:flex;flex-direction:column;align-items:center;
  text-align:center;transition:.3s;overflow:hidden;
}
.card:hover{transform:translateY(-5px);box-shadow:0 0 30px rgba(0,255,255,.25);}
.card img{width:100%;height:220px;object-fit:cover;border-radius:10px;margin-bottom:1rem;}
.card h3{font-size:1.05rem;margin-bottom:0.2rem;}
.card p{color:#aaa;font-size:0.9rem;margin-bottom:0.5rem;}
.card small{display:block;color:#666;font-size:0.8rem;margin-bottom:0.5rem;}
.actions{display:flex;justify-content:center;gap:0.4rem;flex-wrap:wrap;}
.actions button{
  border:none;outline:none;padding:7px 12px;border-radius:8px;
  font-weight:600;cursor:pointer;transition:all .25s;
  display:flex;align-items:center;gap:5px;
}
.download{background:linear-gradient(90deg,#00ffaa,#00e0ff);color:#000;}
.edit{background:rgba(255,255,0,0.15);border:1px solid rgba(255,255,0,0.3);color:#ffd633;}
.delete{background:rgba(255,0,0,0.12);border:1px solid rgba(255,0,0,0.3);color:#ff6b6b;}
.actions button:hover{transform:translateY(-2px);}
.download:hover{box-shadow:0 0 15px rgba(0,255,255,.4);}
.edit:hover{box-shadow:0 0 15px rgba(255,255,0,.4);}
.delete:hover{box-shadow:0 0 15px rgba(255,0,0,.4);}
.message{text-align:center;margin-top:25px;font-size:1rem;color:#00ffaa;display:none;}

/* Modal */
.modal{
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.75);display:none;
  justify-content:center;align-items:center;z-index:9999;
}
.modal-content{
  background:rgba(25,25,25,0.95);
  border:1px solid rgba(255,255,255,0.08);
  border-radius:16px;
  padding:1.5rem;width:90%;max-width:400px;
  text-align:center;box-shadow:0 0 25px rgba(0,255,255,0.2);
  backdrop-filter:blur(10px);animation:fadeIn .3s ease;
}
@keyframes fadeIn{from{opacity:0;transform:scale(.9);}to{opacity:1;transform:scale(1);}}
.modal img{width:100px;height:100px;object-fit:cover;border-radius:10px;margin-bottom:1rem;}
.modal input{
  width:100%;padding:0.6rem 1rem;margin:0.4rem 0;
  border:none;border-radius:8px;background:#111;color:#fff;
  border:1px solid rgba(255,255,255,0.1);
}
.modal button{
  margin-top:0.8rem;
  padding:0.6rem 1.4rem;border:none;border-radius:10px;
  cursor:pointer;font-weight:600;
  transition:.25s;
}
.save-btn{background:linear-gradient(90deg,#00ffaa,#00e0ff);color:#000;}
.close-btn{background:rgba(255,0,0,0.15);color:#ff6b6b;margin-left:8px;}
.save-btn:hover{transform:translateY(-2px);box-shadow:0 0 15px rgba(0,255,255,.3);}
.close-btn:hover{transform:translateY(-2px);box-shadow:0 0 15px rgba(255,0,0,.3);}
footer{text-align:center;margin-top:60px;color:#777;font-size:0.9rem;}
footer a{color:#00e0ff;text-decoration:none;}
footer a:hover{color:#00ffaa;}
</style>
</head>
<body>
<header>
  <h1><i class="fa-solid fa-gear"></i> Manage Books</h1>
  <nav class="nav-links" id="navLinks">
    <a href="/dashboard"><i class="fa-solid fa-house"></i> Dashboard</a>
    <a href="/upload"><i class="fa-solid fa-upload"></i> Upload</a>
    <a href="/manage" style="color:#00ffaa;"><i class="fa-solid fa-gear"></i> Manage</a>
    <a href="/admin" style="color:#ff6b6b;"><i class="fa-solid fa-right-from-bracket"></i> Logout</a>
  </nav>
  <div class="menu-toggle" id="menuBtn"><i class="fa-solid fa-bars"></i></div>
</header>

<div class="filters">
  <button class="active" id="allBtn">üìò All Books</button>
  <button id="recentBtn">üïí Recently Uploaded</button>
</div>

<main>
  <div class="grid" id="bookGrid"><p style="text-align:center;color:#777;">Loading...</p></div>
  <p class="message" id="msg"></p>
</main>

<!-- Edit Modal -->
<div class="modal" id="editModal">
  <div class="modal-content">
    <img id="editThumb" src="" alt="Thumbnail">
    <input type="text" id="editTitle" placeholder="Book Title">
    <input type="text" id="editAuthor" placeholder="Author">
    <input type="text" id="editCategory" placeholder="Category">
    <button class="save-btn" id="saveEdit">Save</button>
    <button class="close-btn" id="closeModal">Cancel</button>
  </div>
</div>

<footer>¬© 2025 OceanBooks | <a href="/main">Main Page</a></footer>

<script>
let currentBook=null;
let allBooks=[];

// üì± Toggle Menu
const menuBtn=document.getElementById('menuBtn');
const navLinks=document.getElementById('navLinks');
menuBtn.addEventListener('click',()=>navLinks.classList.toggle('active'));

// üìö Load Books
async function loadBooks(){
  const grid=document.getElementById('bookGrid');
  grid.innerHTML='<p style="text-align:center;color:#777;">Loading...</p>';
  try{
    const res=await fetch('https://oceanbooks.onrender.com/api/books');
    allBooks=await res.json();
    showAllBooks();
  }catch(e){
    grid.innerHTML='<p style="text-align:center;color:#f55;">Error loading books.</p>';
  }
}

function showAllBooks(){
  displayBooks(allBooks);
  document.getElementById('allBtn').classList.add('active');
  document.getElementById('recentBtn').classList.remove('active');
}

function showRecentBooks(){
  const now=new Date();
  const recent=allBooks.filter(b=>{
    const upload=new Date(b.upload_date);
    const diff=(now-upload)/1000/60/60; // in hours
    return diff<=24;
  });
  displayBooks(recent);
  document.getElementById('recentBtn').classList.add('active');
  document.getElementById('allBtn').classList.remove('active');
}

function displayBooks(list){
  const grid=document.getElementById('bookGrid');
  grid.innerHTML='';
  if(!list.length){
    grid.innerHTML='<p style="text-align:center;color:#888;">No books found.</p>';
    return;
  }
  list.forEach(b=>{
    const card=document.createElement('div');
    card.className='card';
    card.innerHTML=`
      <img src="${b.thumbnail_path}" alt="${b.title}">
      <h3>${b.title}</h3>
      <p>${b.author}</p>
      <small>${b.category}</small>
      <div class="actions">
        <button class="download" onclick="downloadBook(${b.id})"><i class="fa-solid fa-download"></i></button>
        <button class="edit" onclick='openEdit(${JSON.stringify(b)})'><i class="fa-solid fa-pen"></i></button>
        <button class="delete" onclick="deleteBook(${b.id})"><i class="fa-solid fa-trash"></i></button>
      </div>`;
    grid.appendChild(card);
  });
}

// üñäÔ∏è Edit
function openEdit(b){
  currentBook=b;
  document.getElementById('editThumb').src=b.thumbnail_path;
  document.getElementById('editTitle').value=b.title;
  document.getElementById('editAuthor').value=b.author;
  document.getElementById('editCategory').value=b.category;
  document.getElementById('editModal').style.display='flex';
}
document.getElementById('closeModal').onclick=()=>document.getElementById('editModal').style.display='none';
document.getElementById('saveEdit').onclick=async()=>{
  if(!currentBook)return;
  const title=document.getElementById('editTitle').value;
  const author=document.getElementById('editAuthor').value;
  const category=document.getElementById('editCategory').value;
  const res=await fetch(`https://oceanbooks.onrender.com/api/books/${currentBook.id}`,{
    method:'PUT',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({title,author,category})
  });
  const data=await res.json();
  const msg=document.getElementById('msg');
  msg.style.display='block';
  if(res.ok && data.success){msg.textContent='‚úÖ Updated!';msg.style.color='#00ffaa';loadBooks();}
  else{msg.textContent='‚ùå Error updating';msg.style.color='#ff5555';}
  setTimeout(()=>msg.style.display='none',2500);
  document.getElementById('editModal').style.display='none';
};

// üóëÔ∏è Delete
async function deleteBook(id){
  if(!confirm('Delete this book permanently?')) return;
  const res=await fetch(`https://oceanbooks.onrender.com/api/books/${id}`,{method:'DELETE'});
  const data=await res.json();
  const msg=document.getElementById('msg');
  msg.style.display='block';
  if(res.ok && data.success){msg.textContent='‚úÖ Deleted!';msg.style.color='#00ffaa';loadBooks();}
  else{msg.textContent='‚ùå Error deleting';msg.style.color='#ff5555';}
  setTimeout(()=>msg.style.display='none',2500);
}

// ‚¨áÔ∏è Download
function downloadBook(id){window.location.href=`https://oceanbooks.onrender.com/api/books/${id}/download`;}

document.getElementById('allBtn').onclick=showAllBooks;
document.getElementById('recentBtn').onclick=showRecentBooks;
loadBooks();
</script>
</body>
</html>